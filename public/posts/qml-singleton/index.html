<!doctype html><html lang=pt dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>QML Singleton | danieltak</title>
<meta name=keywords content="Singleton,DesignPattern"><meta name=description content="Instância única"><meta name=author content="danieltak"><link rel=canonical href=http://localhost:1313/posts/qml-singleton/><meta name=google-site-verification content="G-42TTSQCNKE"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=pt href=http://localhost:1313/posts/qml-singleton/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><meta property="og:title" content="QML Singleton"><meta property="og:description" content="Instância única"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/qml-singleton/"><meta property="og:image" content="http://localhost:1313/images/qml-singleton/singleton.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-16T20:11:32-03:00"><meta property="article:modified_time" content="2024-02-16T20:11:32-03:00"><meta property="og:site_name" content="danieltak"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/images/qml-singleton/singleton.png"><meta name=twitter:title content="QML Singleton"><meta name=twitter:description content="Instância única"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"QML Singleton","item":"http://localhost:1313/posts/qml-singleton/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"QML Singleton","name":"QML Singleton","description":"Instância única","keywords":["Singleton","DesignPattern"],"articleBody":"Introdução No QML muitas vezes é necessário o acesso global à variáveis e funções, isso pode ser alcançado com um padrão de projeto Singleton.\nUm exemplo é a configuração global de um software, que além de ser acessado por qualquer janela, deve também salvar os dados de configuração em algum arquivo.\nO Singleton é um padrão de projeto criacional que permite a você garantir que uma classe tenha apenas uma instância, enquanto provê um ponto de acesso global para essa instância.\nSingleton O Refactoring.guru diz o seguinte:\nO padrão Singleton resolve dois problemas de uma só vez, violando o princípio de responsabilidade única:\nGarantir que uma classe tenha apenas uma única instância. Por que alguém iria querer controlar quantas instâncias uma classe tem? A razão mais comum para isso é para controlar o acesso a algum recurso compartilhado, por exemplo, uma base de dados ou um arquivo. Funciona assim: imagine que você criou um objeto, mas depois de um tempo você decidiu criar um novo. Ao invés de receber um objeto fresco, você obterá um que já foi criado.\nObserve que esse comportamento é impossível implementar com um construtor regular uma vez que uma chamada do construtor deve sempre retornar um novo objeto por design.\nFornece um ponto de acesso global para aquela instância. Se lembra daquelas variáveis globais que você (tá bom, eu) usou para guardar alguns objetos essenciais? Embora sejam muito úteis, elas também são muito inseguras uma vez que qualquer código pode potencialmente sobrescrever os conteúdos daquelas variáveis e quebrar a aplicação. Assim como uma variável global, o padrão Singleton permite que você acesse algum objeto de qualquer lugar no programa. Contudo, ele também protege aquela instância de ser sobrescrita por outro código.\nHá outro lado para esse problema: você não quer que o código que resolve o problema #1 fique espalhado por todo seu programa. É muito melhor tê-lo dentro de uma classe, especialmente se o resto do seu código já depende dela.\nCMake Muitos tutoriais antigos dizem para alterar o qmldir, mas no Qt6, o qmldir é gerado automaticamente, portanto, uma das maneiras é declarar que uma classe QML é singleton no CMake.\nset_source_files_properties(MyTheme.qml PROPERTIES QT_QML_SINGLETON_TYPE TRUE)\nE no cabeçalho da classe pragma Singleton\nUm Example Singleton1 pode ser visto no github, em que a classe QML MySingleton é criada com as seguintes propriedades:\nproperty string helloWorld: property string loremIpsum: property bool changeTextColor: E o seguinte código é usado para um teste numa janela:\nimport QtQuick import QtQuick.Controls Window { width: 640 height: 480 visible: true color: \"#888888\" title: qsTr( MySingleton.helloWorld ) Text{ id: myText width: parent.width font.pixelSize: 22 color: MySingleton.changeTextColor ? \"red\" : \"blue\" text: MySingleton.loremIpsum wrapMode: Text.WrapAnywhere } Button{ id: myButton anchors.top: myText.bottom width: parent.width / 4 text: \"Trocar Cor\" onClicked: { MySingleton.changeTextColor = !MySingleton.changeTextColor; } } } Classe C++ Muitas vezes o QML é limitado e é necessário criar classes em C++.\nPara criar um singleton numa classe C++, vamos criar um header chamado singleton.h, com templates e thread-safe. Utilizando como base o projeto do FluentUI.\nPara ser thread-safe, a classe QMutexLocker foi utilizada, mas um lock_guard também poderia ser utilizado.\nO exemplo completo pode ser visto no repositório Example Singleton2.\nLembrando se for utilizar o lock_guard, veja a guideline CP44\nQMutexLocker O QMutexLocker deve ser criado em uma função na qual um QMutex precisa ser bloqueado. O mutex é bloqueado quando o QMutexLocker é criado. Você pode desbloquear e bloquear novamente o mutex com unlock() e relock(). Se estiver bloqueado, o mutex será desbloqueado quando o QMutexLocker for destruído.\nPor exemplo, a seguinte função bloqueia e desbloqueia um QMutex, tendo que garantir que um Deadlock não ocorra.\nint complexFunction(int flag) { mutex.lock(); int retVal = 0; switch (flag) { case 0: case 1: retVal = moreComplexFunction(flag); break; case 2: { int status = anotherFunction(); if (status \u003c 0) { mutex.unlock(); return -2; } retVal = status + flag; } break; default: if (flag \u003e 10) { mutex.unlock(); return -1; } break; } mutex.unlock(); return retVal; } O uso do QMutexLocker simplifica muito o código e o torna mais legível:\nint complexFunction(int flag) { QMutexLocker locker(\u0026mutex); int retVal = 0; switch (flag) { case 0: case 1: return moreComplexFunction(flag); case 2: { int status = anotherFunction(); if (status \u003c 0) return -2; retVal = status + flag; } break; default: if (flag \u003e 10) return -1; break; } return retVal; } Opinião: Eu pessoalmente prefiro usar as funções do STL, como o lock_guard. Mas vou manter o uso do QMutexLocker para fins educacionais, pois há bastante material sobre o lock_guard na internet.\nEstanciador Singleton A classe singleton.h pode ser criada com o #define SINGLETON(Class) para construir a classe com o template definido no header.\n#ifndef SINGLETON_H #define SINGLETON_H #include template \u003ctypename T\u003e class Singleton { public: static T* getInstance(); private: Q_DISABLE_COPY_MOVE(Singleton) }; template \u003ctypename T\u003e T* Singleton\u003cT\u003e::getInstance() { static QMutex mutex; QMutexLocker locker(\u0026mutex); static T* instance = nullptr; if (instance == nullptr) { instance = new T(); } return instance; } #define SINGLETON(Class) \\ private: \\ friend class Singleton; \\ public: \\ static Class* getInstance() { \\ return Singleton::getInstance(); \\ } #define HIDE_CONSTRUCTOR(Class) \\ private: \\ Class() = default; \\ Class(const Class\u0026 other) = delete; \\ Q_DISABLE_COPY_MOVE(Class); #endif // SINGLETON_H Classe Singleton Criamos a classe MySingleton, adicionando as variáveis com a Macro Qt Q_PROPERTY, QML_NAMED_ELEMENT, QML_SINGLETON e o instanciando o singleton com o #define SINGLETON(Class).\nO header fica da seguinte maneira:\n#ifndef MYSINGLETON_H #define MYSINGLETON_H #include #include #include #include \"singleton.h\" class MySingleton : public QObject { Q_OBJECT Q_PROPERTY( QString helloWorld READ helloWorld WRITE helloWorld NOTIFY helloWorldChanged ) Q_PROPERTY( QString loremIpsum READ loremIpsum WRITE loremIpsum NOTIFY loremIpsumChanged ) Q_PROPERTY( bool changeTextColor READ changeTextColor WRITE changeTextColor NOTIFY textColorChanged ) QML_NAMED_ELEMENT(MySingleton) QML_SINGLETON protected: QString helloWorld() const; void helloWorld( QString newString ); QString loremIpsum() const; void loremIpsum( QString newString ); bool changeTextColor() const; void changeTextColor( bool newValue ); private: explicit MySingleton(QObject *parent = nullptr); public: SINGLETON(MySingleton) static MySingleton *create(QQmlEngine *qmlEngine, QJSEngine *jsEngine){return getInstance();} public: QString m_helloWorld; QString m_loremIpsum; bool m_changeTextColor; signals: void helloWorldChanged(); void loremIpsumChanged(); void textColorChanged(); }; #endif // MYSINGLETON_H No cpp inicializamos os membros da classe no construtor e criamos as funções com overload de READ e WRITE da do Q_PROPERTY, emitindo o sinal de “changed” que será notificado pelo sistema de eventos do Qt.\n#include \"MySingleton.h\" MySingleton::MySingleton(QObject *parent) : QObject{parent}, m_helloWorld(\"Hello World!\"), m_loremIpsum(\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis convallis sapien. In pharetra, urna quis ornare bibendum, neque lacus varius tortor, sed pretium nunc ante a metus. Fusce finibus semper urna, quis pharetra odio tincidunt feugiat. Quisque fermentum elementum velit auctor sagittis. Aenean ac aliquam diam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod iaculis massa, sed pretium eros cursus a. Aenean eu tortor sed augue maximus pharetra. Aliquam erat volutpat. Pellentesque malesuada nibh quam, eu consequat elit pretium vel.\"), m_changeTextColor(false) { } QString MySingleton::helloWorld() const { return m_helloWorld; } void MySingleton::helloWorld(QString newString) { m_helloWorld = newString; emit helloWorldChanged(); } QString MySingleton::loremIpsum() const { return m_loremIpsum; } void MySingleton::loremIpsum(QString newString) { m_loremIpsum = newString; emit loremIpsumChanged(); } bool MySingleton::changeTextColor() const { return m_changeTextColor; } void MySingleton::changeTextColor(bool newValue) { m_changeTextColor = newValue; emit textColorChanged(); } Referência Singleton Design Pattern Exemplo Singleton1 Exemplo Singleton2 FluentUI QMutexLocker lock_guard CP.44: Remember to name your lock_guards and unique_locks Q_PROPERTY ","wordCount":"1210","inLanguage":"pt","image":"http://localhost:1313/images/qml-singleton/singleton.png","datePublished":"2024-02-16T20:11:32-03:00","dateModified":"2024-02-16T20:11:32-03:00","author":{"@type":"Person","name":"danieltak"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/qml-singleton/"},"publisher":{"@type":"Organization","name":"danieltak","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/procurar/ title=Procurar><span>Procurar</span></a></li><li><a href=http://localhost:1313/categorias/ title=Categorias><span>Categorias</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/arquivos/ title=Arquivos><span>Arquivos</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Início</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">QML Singleton</h1><div class=post-description>Instância única</div><div class=post-meta><span title='2024-02-16 20:11:32 -0300 -03'>16 fev. 2024</span>&nbsp;·&nbsp;6 minutos&nbsp;·&nbsp;1210 palavras&nbsp;·&nbsp;danieltak&nbsp;|&nbsp;<a href=https://github.com/danieltak/danieltak-blog/blob/master/content/posts/qml-singleton.md rel="noopener noreferrer" target=_blank>Sugerir Alterações</a></div></header><figure class=entry-cover><img loading=eager srcset="http://localhost:1313/images/qml-singleton/singleton_hu16178003677117401940.png 360w ,http://localhost:1313/images/qml-singleton/singleton_hu5781715956438365737.png 480w ,http://localhost:1313/images/qml-singleton/singleton.png 640w" sizes="(min-width: 768px) 720px, 100vw" src=http://localhost:1313/images/qml-singleton/singleton.png alt=https://refactoring.guru/images/patterns/content/singleton/singleton.png width=640 height=400><p>fonte: <a href=https://refactoring.guru/>https://refactoring.guru/</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Conteúdo</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introdução>Introdução</a></li><li><a href=#singleton>Singleton</a></li><li><a href=#cmake>CMake</a></li><li><a href=#classe-c>Classe C++</a><ul><li><a href=#qmutexlocker>QMutexLocker</a></li><li><a href=#estanciador-singleton>Estanciador Singleton</a></li><li><a href=#classe-singleton>Classe Singleton</a></li></ul></li><li><a href=#referência>Referência</a></li></ul></nav></div></details></div><div class=post-content><h2 id=introdução>Introdução<a hidden class=anchor aria-hidden=true href=#introdução>#</a></h2><p>No QML muitas vezes é necessário o acesso global à variáveis e funções, isso pode ser alcançado com um padrão de projeto <a href=https://refactoring.guru/pt-br/design-patterns/singleton>Singleton</a>.</p><p>Um exemplo é a configuração global de um software, que além de ser acessado por qualquer janela, deve também salvar os dados de configuração em algum arquivo.</p><blockquote><p>O Singleton é um padrão de projeto criacional que permite a você garantir que uma classe tenha apenas uma instância, enquanto provê um ponto de acesso global para essa instância.</p></blockquote><h2 id=singleton>Singleton<a hidden class=anchor aria-hidden=true href=#singleton>#</a></h2><p>O <a href=https://refactoring.guru/pt-br/design-patterns/singleton>Refactoring.guru</a> diz o seguinte:</p><p>O padrão Singleton resolve dois problemas de uma só vez, violando o princípio de responsabilidade única:</p><ol><li><strong>Garantir que uma classe tenha apenas uma única instância.</strong> Por que alguém iria querer controlar quantas instâncias uma classe tem? A razão mais comum para isso é para controlar o acesso a algum recurso compartilhado, por exemplo, uma base de dados ou um arquivo.</li></ol><p>Funciona assim: imagine que você criou um objeto, mas depois de um tempo você decidiu criar um novo. Ao invés de receber um objeto fresco, você obterá um que já foi criado.</p><p>Observe que esse comportamento é impossível implementar com um construtor regular uma vez que uma chamada do construtor deve sempre retornar um novo objeto por design.</p><ol start=2><li><strong>Fornece um ponto de acesso global para aquela instância.</strong> Se lembra daquelas variáveis globais que você (tá bom, eu) usou para guardar alguns objetos essenciais? Embora sejam muito úteis, elas também são muito inseguras uma vez que qualquer código pode potencialmente sobrescrever os conteúdos daquelas variáveis e quebrar a aplicação.</li></ol><p>Assim como uma variável global, o padrão Singleton permite que você acesse algum objeto de qualquer lugar no programa. Contudo, ele também protege aquela instância de ser sobrescrita por outro código.</p><p>Há outro lado para esse problema: você não quer que o código que resolve o problema #1 fique espalhado por todo seu programa. É muito melhor tê-lo dentro de uma classe, especialmente se o resto do seu código já depende dela.</p><h2 id=cmake>CMake<a hidden class=anchor aria-hidden=true href=#cmake>#</a></h2><p>Muitos tutoriais antigos dizem para alterar o qmldir, mas no Qt6, o qmldir é gerado automaticamente, portanto, uma das maneiras é declarar que uma classe QML é singleton no CMake.</p><p><code>set_source_files_properties(MyTheme.qml PROPERTIES QT_QML_SINGLETON_TYPE TRUE)</code></p><p>E no cabeçalho da classe <code>pragma Singleton</code></p><p>Um <a href=https://github.com/danieltak/danieltak-blog/blob/master/exemplos/Singleton1>Example Singleton1</a> pode ser visto no github, em que a classe QML <code>MySingleton</code> é criada com as seguintes propriedades:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>property</span> <span class=n>string</span> <span class=nl>helloWorld</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>property</span> <span class=n>string</span> <span class=nl>loremIpsum</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>property</span> <span class=kt>bool</span> <span class=nl>changeTextColor</span><span class=p>:</span>
</span></span></code></pre></div><p>E o seguinte código é usado para um teste numa janela:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>import</span> <span class=n>QtQuick</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>QtQuick</span><span class=p>.</span><span class=n>Controls</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Window</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nl>width</span><span class=p>:</span> <span class=mi>640</span>
</span></span><span class=line><span class=cl>    <span class=nl>height</span><span class=p>:</span> <span class=mi>480</span>
</span></span><span class=line><span class=cl>    <span class=nl>visible</span><span class=p>:</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>    <span class=nl>color</span><span class=p>:</span> <span class=s>&#34;#888888&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nl>title</span><span class=p>:</span> <span class=n>qsTr</span><span class=p>(</span> <span class=n>MySingleton</span><span class=p>.</span><span class=n>helloWorld</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Text</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nl>id</span><span class=p>:</span> <span class=n>myText</span>
</span></span><span class=line><span class=cl>        <span class=nl>width</span><span class=p>:</span> <span class=n>parent</span><span class=p>.</span><span class=n>width</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>font</span><span class=p>.</span><span class=nl>pixelSize</span><span class=p>:</span> <span class=mi>22</span>
</span></span><span class=line><span class=cl>        <span class=nl>color</span><span class=p>:</span> <span class=n>MySingleton</span><span class=p>.</span><span class=n>changeTextColor</span> <span class=o>?</span> <span class=s>&#34;red&#34;</span> <span class=o>:</span> <span class=s>&#34;blue&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nl>text</span><span class=p>:</span> <span class=n>MySingleton</span><span class=p>.</span><span class=n>loremIpsum</span>
</span></span><span class=line><span class=cl>        <span class=nl>wrapMode</span><span class=p>:</span> <span class=n>Text</span><span class=p>.</span><span class=n>WrapAnywhere</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Button</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nl>id</span><span class=p>:</span> <span class=n>myButton</span>
</span></span><span class=line><span class=cl>        <span class=n>anchors</span><span class=p>.</span><span class=nl>top</span><span class=p>:</span> <span class=n>myText</span><span class=p>.</span><span class=n>bottom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nl>width</span><span class=p>:</span> <span class=n>parent</span><span class=p>.</span><span class=n>width</span> <span class=o>/</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>        <span class=nl>text</span><span class=p>:</span> <span class=s>&#34;Trocar Cor&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nl>onClicked</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>MySingleton</span><span class=p>.</span><span class=n>changeTextColor</span> <span class=o>=</span> <span class=o>!</span><span class=n>MySingleton</span><span class=p>.</span><span class=n>changeTextColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img loading=lazy src=/posts/images/qml-singleton/Singleton1.gif alt="Result Singleton1"></p><h2 id=classe-c>Classe C++<a hidden class=anchor aria-hidden=true href=#classe-c>#</a></h2><p>Muitas vezes o QML é limitado e é necessário criar classes em C++.</p><p>Para criar um singleton numa classe C++, vamos criar um header chamado <code>singleton.h</code>, com templates e thread-safe. Utilizando como base o projeto do <a href=https://github.com/zhuzichu520/FluentUI>FluentUI</a>.</p><p>Para ser thread-safe, a classe <a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a> foi utilizada, mas um <a href=https://en.cppreference.com/w/cpp/thread/lock_guard>lock_guard</a> também poderia ser utilizado.</p><p>O exemplo completo pode ser visto no repositório <a href=https://github.com/danieltak/danieltak-blog/blob/master/exemplos/Singleton2>Example Singleton2</a>.</p><blockquote><p>Lembrando se for utilizar o <a href=https://en.cppreference.com/w/cpp/thread/lock_guard>lock_guard</a>, veja a <a href=https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rconc-name>guideline CP44</a></p></blockquote><h3 id=qmutexlocker>QMutexLocker<a hidden class=anchor aria-hidden=true href=#qmutexlocker>#</a></h3><p>O <a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a> deve ser criado em uma função na qual um QMutex precisa ser bloqueado. O mutex é bloqueado quando o <a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a> é criado. Você pode desbloquear e bloquear novamente o mutex com <code>unlock()</code> e <code>relock()</code>. Se estiver bloqueado, o mutex será desbloqueado quando o <a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a> for destruído.</p><p>Por exemplo, a seguinte função bloqueia e desbloqueia um QMutex, tendo que garantir que um Deadlock não ocorra.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>complexFunction</span><span class=p>(</span><span class=kt>int</span> <span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>mutex</span><span class=p>.</span><span class=n>lock</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>retVal</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>flag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>retVal</span> <span class=o>=</span> <span class=n>moreComplexFunction</span><span class=p>(</span><span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>status</span> <span class=o>=</span> <span class=n>anotherFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>status</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>mutex</span><span class=p>.</span><span class=n>unlock</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>retVal</span> <span class=o>=</span> <span class=n>status</span> <span class=o>+</span> <span class=n>flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>flag</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>mutex</span><span class=p>.</span><span class=n>unlock</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mutex</span><span class=p>.</span><span class=n>unlock</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>retVal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>O uso do QMutexLocker simplifica muito o código e o torna mais legível:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>complexFunction</span><span class=p>(</span><span class=kt>int</span> <span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QMutexLocker</span> <span class=n>locker</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>retVal</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>flag</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>0</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>moreComplexFunction</span><span class=p>(</span><span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>status</span> <span class=o>=</span> <span class=n>anotherFunction</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>status</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>retVal</span> <span class=o>=</span> <span class=n>status</span> <span class=o>+</span> <span class=n>flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>flag</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>retVal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Opinião:</strong> Eu pessoalmente prefiro usar as funções do STL, como o <a href=https://en.cppreference.com/w/cpp/thread/lock_guard>lock_guard</a>. Mas vou manter o uso do <a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a> para fins educacionais, pois há bastante material sobre o <a href=https://en.cppreference.com/w/cpp/thread/lock_guard>lock_guard</a> na internet.</p><h3 id=estanciador-singleton>Estanciador Singleton<a hidden class=anchor aria-hidden=true href=#estanciador-singleton>#</a></h3><p>A classe <code>singleton.h</code> pode ser criada com o <code>#define SINGLETON(Class)</code> para construir a classe com o template definido no header.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef SINGLETON_H
</span></span></span><span class=line><span class=cl><span class=cp>#define SINGLETON_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QMutex&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>T</span><span class=o>*</span> <span class=n>getInstance</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_DISABLE_COPY_MOVE</span><span class=p>(</span><span class=n>Singleton</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>T</span><span class=o>*</span> <span class=n>Singleton</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;::</span><span class=n>getInstance</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>QMutex</span> <span class=n>mutex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>QMutexLocker</span> <span class=nf>locker</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>T</span><span class=o>*</span> <span class=n>instance</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>instance</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>T</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define SINGLETON(Class)                        \
</span></span></span><span class=line><span class=cl><span class=cp>private:                                        \
</span></span></span><span class=line><span class=cl><span class=cp>    friend class Singleton&lt;Class&gt;;              \
</span></span></span><span class=line><span class=cl><span class=cp>    public:                                     \
</span></span></span><span class=line><span class=cl><span class=cp>    static Class* getInstance() {               \
</span></span></span><span class=line><span class=cl><span class=cp>        return Singleton&lt;Class&gt;::getInstance(); \
</span></span></span><span class=line><span class=cl><span class=cp>}
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define HIDE_CONSTRUCTOR(Class)         \
</span></span></span><span class=line><span class=cl><span class=cp>private:                                \
</span></span></span><span class=line><span class=cl><span class=cp>    Class() = default;                  \
</span></span></span><span class=line><span class=cl><span class=cp>    Class(const Class&amp; other) = delete; \
</span></span></span><span class=line><span class=cl><span class=cp>    Q_DISABLE_COPY_MOVE(Class);
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// SINGLETON_H
</span></span></span></code></pre></div><h3 id=classe-singleton>Classe Singleton<a hidden class=anchor aria-hidden=true href=#classe-singleton>#</a></h3><p>Criamos a classe <code>MySingleton</code>, adicionando as variáveis com a Macro Qt <a href=https://doc.qt.io/qt-6/properties.html>Q_PROPERTY</a>, <code>QML_NAMED_ELEMENT</code>, <code>QML_SINGLETON</code> e o instanciando o singleton com o <code>#define SINGLETON(Class)</code>.</p><p>O header fica da seguinte maneira:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef MYSINGLETON_H
</span></span></span><span class=line><span class=cl><span class=cp>#define MYSINGLETON_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QObject&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QString&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtQml/qqml.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;singleton.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MySingleton</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>    <span class=nf>Q_PROPERTY</span><span class=p>(</span> <span class=n>QString</span> <span class=n>helloWorld</span> <span class=n>READ</span> <span class=n>helloWorld</span> <span class=n>WRITE</span> <span class=n>helloWorld</span> <span class=n>NOTIFY</span> <span class=n>helloWorldChanged</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_PROPERTY</span><span class=p>(</span> <span class=n>QString</span> <span class=n>loremIpsum</span> <span class=n>READ</span> <span class=n>loremIpsum</span> <span class=n>WRITE</span> <span class=n>loremIpsum</span> <span class=n>NOTIFY</span> <span class=n>loremIpsumChanged</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_PROPERTY</span><span class=p>(</span> <span class=kt>bool</span> <span class=n>changeTextColor</span> <span class=n>READ</span> <span class=n>changeTextColor</span> <span class=n>WRITE</span> <span class=n>changeTextColor</span> <span class=n>NOTIFY</span> <span class=n>textColorChanged</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>QML_NAMED_ELEMENT</span><span class=p>(</span><span class=n>MySingleton</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>QML_SINGLETON</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=n>helloWorld</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>helloWorld</span><span class=p>(</span> <span class=n>QString</span> <span class=n>newString</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=nf>loremIpsum</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>loremIpsum</span><span class=p>(</span> <span class=n>QString</span> <span class=n>newString</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>changeTextColor</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>changeTextColor</span><span class=p>(</span> <span class=kt>bool</span> <span class=n>newValue</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MySingleton</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SINGLETON</span><span class=p>(</span><span class=n>MySingleton</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>MySingleton</span> <span class=o>*</span><span class=n>create</span><span class=p>(</span><span class=n>QQmlEngine</span> <span class=o>*</span><span class=n>qmlEngine</span><span class=p>,</span> <span class=n>QJSEngine</span> <span class=o>*</span><span class=n>jsEngine</span><span class=p>){</span><span class=k>return</span> <span class=nf>getInstance</span><span class=p>();}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=n>m_helloWorld</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>QString</span> <span class=n>m_loremIpsum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>m_changeTextColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>signals</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>helloWorldChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>loremIpsumChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>textColorChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// MYSINGLETON_H
</span></span></span></code></pre></div><p>No cpp inicializamos os membros da classe no construtor e criamos as funções com overload de READ e WRITE da do <a href=https://doc.qt.io/qt-6/properties.html>Q_PROPERTY</a>, emitindo o sinal de &ldquo;changed&rdquo; que será notificado pelo sistema de eventos do Qt.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;MySingleton.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>MySingleton</span><span class=o>::</span><span class=n>MySingleton</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>QObject</span><span class=p>{</span><span class=n>parent</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>m_helloWorld</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>m_loremIpsum</span><span class=p>(</span><span class=s>&#34;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis convallis sapien. In pharetra, urna quis ornare bibendum, neque lacus varius tortor, sed pretium nunc ante a metus. Fusce finibus semper urna, quis pharetra odio tincidunt feugiat. Quisque fermentum elementum velit auctor sagittis. Aenean ac aliquam diam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod iaculis massa, sed pretium eros cursus a. Aenean eu tortor sed augue maximus pharetra. Aliquam erat volutpat. Pellentesque malesuada nibh quam, eu consequat elit pretium vel.&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>m_changeTextColor</span><span class=p>(</span><span class=nb>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>QString</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>helloWorld</span><span class=p>()</span> <span class=k>const</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m_helloWorld</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>helloWorld</span><span class=p>(</span><span class=n>QString</span> <span class=n>newString</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>m_helloWorld</span> <span class=o>=</span> <span class=n>newString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=nf>helloWorldChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>QString</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>loremIpsum</span><span class=p>()</span> <span class=k>const</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m_loremIpsum</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>loremIpsum</span><span class=p>(</span><span class=n>QString</span> <span class=n>newString</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>m_loremIpsum</span> <span class=o>=</span> <span class=n>newString</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=nf>loremIpsumChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>changeTextColor</span><span class=p>()</span> <span class=k>const</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m_changeTextColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MySingleton</span><span class=o>::</span><span class=n>changeTextColor</span><span class=p>(</span><span class=kt>bool</span> <span class=n>newValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>m_changeTextColor</span> <span class=o>=</span> <span class=n>newValue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=nf>textColorChanged</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=referência>Referência<a hidden class=anchor aria-hidden=true href=#referência>#</a></h2><ul><li><a href=https://refactoring.guru/pt-br/design-patterns/singleton>Singleton Design Pattern</a></li></ul><ul><li><a href=https://github.com/danieltak/danieltak-blog/blob/master/exemplos/Singleton1>Exemplo Singleton1</a></li></ul><ul><li><a href=https://github.com/danieltak/danieltak-blog/blob/master/exemplos/Singleton2>Exemplo Singleton2</a></li></ul><ul><li><a href=https://github.com/zhuzichu520/FluentUI>FluentUI</a></li></ul><ul><li><a href=https://doc.qt.io/qt-6/qmutexlocker.html>QMutexLocker</a></li></ul><ul><li><a href=https://en.cppreference.com/w/cpp/thread/lock_guard>lock_guard</a></li></ul><ul><li><a href=https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rconc-name>CP.44: Remember to name your lock_guards and unique_locks</a></li></ul><ul><li><a href=https://doc.qt.io/qt-6/properties.html>Q_PROPERTY</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/singleton/>Singleton</a></li><li><a href=http://localhost:1313/tags/designpattern/>DesignPattern</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/distancia-dois-pontos-esfera/><span class=title>« Página Anterior</span><br><span>Distância entre Dois Pontos de uma Esfera</span>
</a><a class=next href=http://localhost:1313/posts/linux-time/><span class=title>Próxima Página »</span><br><span>Tempo no Linux</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on x" href="https://x.com/intent/tweet/?text=QML%20Singleton&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f&amp;hashtags=Singleton%2cDesignPattern"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f&amp;title=QML%20Singleton&amp;summary=QML%20Singleton&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f&title=QML%20Singleton"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on whatsapp" href="https://api.whatsapp.com/send?text=QML%20Singleton%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on telegram" href="https://telegram.me/share/url?text=QML%20Singleton&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share QML Singleton on ycombinator" href="https://news.ycombinator.com/submitlink?t=QML%20Singleton&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fqml-singleton%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>danieltak</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>